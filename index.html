<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고객 고지사항 입력</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .error { color: red; display: none; }
        .details { margin-left: 20px; }
        .radio-group { display: flex; gap: 20px; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4 text-center">고객 고지사항 입력</h1>
        <form id="customerForm" class="bg-white p-6 rounded shadow-md">
            <!-- 기본 정보 -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">이름</label>
                <input type="text" id="name" class="mt-1 p-2 w-full border rounded" required>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">생년월일</label>
                <input type="date" id="birthdate" class="mt-1 p-2 w-full border rounded" required>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">직업</label>
                <input type="text" id="occupation" class="mt-1 p-2 w-full border rounded" required>
            </div>

            <!-- 고지사항 문항 -->
            <h2 class="text-lg font-semibold mb-2">건강체 고지사항</h2>
            <div id="questions">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">1. 최근 3개월 이내에 병원 가신 적이 있으신가요? (입원, 수술, 질병확정진단, 질병의심소견, 약처방)</label>
                    <div class="radio-group mt-2">
                        <label><input type="radio" name="q1" value="yes" required> 예</label>
                        <label><input type="radio" name="q1" value="no"> 아니오</label>
                    </div>
                    <div class="details hidden mt-2">
                        <label class="block text-sm">년</label>
                        <input type="number" class="year mt-1 p-2 w-full border rounded" placeholder="YYYY">
                        <label class="block text-sm mt-2">월</label>
                        <input type="number" class="month mt-1 p-2 w-full border rounded" placeholder="MM">
                        <label class="block text-sm mt-2">일</label>
                        <input type="number" class="day mt-1 p-2 w-full border rounded" placeholder="DD">
                        <label class="block text-sm mt-2">병명</label>
                        <input type="text" class="disease mt-1 p-2 w-full border rounded" placeholder="병명">
                        <label class="block text-sm mt-2">치료 내용</label>
                        <input type="text" class="treatment mt-1 p-2 w-full border rounded" placeholder="치료 내용">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">2. 최근 1년 이내에 의사로부터 진찰 또는 검사를 통하여 추가검사, 재검사를 받으신 적이 있으신가요?</label>
                    <div class="radio-group mt-2">
                        <label><input type="radio" name="q2" value="yes" required> 예</label>
                        <label><input type="radio" name="q2" value="no"> 아니오</label>
                    </div>
                    <div class="details hidden mt-2">
                        <label class="block text-sm">년</label>
                        <input type="number" class="year mt-1 p-2 w-full border rounded" placeholder="YYYY">
                        <label class="block text-sm mt-2">월</label>
                        <input type="number" class="month mt-1 p-2 w-full border rounded" placeholder="MM">
                        <label class="block text-sm mt-2">일</label>
                        <input type="number" class="day mt-1 p-2 w-full border rounded" placeholder="DD">
                        <label class="block text-sm mt-2">병명</label>
                        <input type="text" class="disease mt-1 p-2 w-full border rounded" placeholder="병명">
                        <label class="block text-sm mt-2">치료 내용</label>
                        <input type="text" class="treatment mt-1 p-2 w-full border rounded" placeholder="치료 내용">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">3. 최근 5년 이내 입원, 수술, 하나의 질병 또는 사고로 7일 이상 통원, 30일 이상 약을 복용하신 적이 있으신가요?</label>
                    <div class="radio-group mt-2">
                        <label><input type="radio" name="q3" value="yes" required> 예</label>
                        <label><input type="radio" name="q3" value="no"> 아니오</label>
                    </div>
                    <div class="details hidden mt-2">
                        <label class="block text-sm">년</label>
                        <input type="number" class="year mt-1 p-2 w-full border rounded" placeholder="YYYY">
                        <label class="block text-sm mt-2">월</label>
                        <input type="number" class="month mt-1 p-2 w-full border rounded" placeholder="MM">
                        <label class="block text-sm mt-2">일</label>
                        <input type="number" class="day mt-1 p-2 w-full border rounded" placeholder="DD">
                        <label class="block text-sm mt-2">병명</label>
                        <input type="text" class="disease mt-1 p-2 w-full border rounded" placeholder="병명">
                        <label class="block text-sm mt-2">치료 내용</label>
                        <input type="text" class="treatment mt-1 p-2 w-full border rounded" placeholder="치료 내용">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">4. 최근 5년 이내 10대 질병 (암, 백혈병, 고혈압, 협심증, 심근경색, 심장판막증, 간경화, 뇌졸중(뇌출혈, 뇌경색), 당뇨병, 에이즈)으로 진단 및 치료받으신 적이 있으신가요?</label>
                    <div class="radio-group mt-2">
                        <label><input type="radio" name="q4" value="yes" required> 예</label>
                        <label><input type="radio" name="q4" value="no"> 아니오</label>
                    </div>
                    <div class="details hidden mt-2">
                        <label class="block text-sm">년</label>
                        <input type="number" class="year mt-1 p-2 w-full border rounded" placeholder="YYYY">
                        <label class="block text-sm mt-2">월</label>
                        <input type="number" class="month mt-1 p-2 w-full border rounded" placeholder="MM">
                        <label class="block text-sm mt-2">일</label>
                        <input type="number" class="day mt-1 p-2 w-full border rounded" placeholder="DD">
                        <label class="block text-sm mt-2">병명</label>
                        <input type="text" class="disease mt-1 p-2 w-full border rounded" placeholder="병명">
                        <label class="block text-sm mt-2">치료 내용</label>
                        <input type="text" class="treatment mt-1 p-2 w-full border rounded" placeholder="치료 내용">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">5. 최근 10년 이내 입원이나 수술하신 적이 있으신가요?</label>
                    <div class="radio-group mt-2">
                        <label><input type="radio" name="q5" value="yes" required> 예</label>
                        <label><input type="radio" name="q5" value="no"> 아니오</label>
                    </div>
                    <div class="details hidden mt-2">
                        <label class="block text-sm">년</label>
                        <input type="number" class="year mt-1 p-2 w-full border rounded" placeholder="YYYY">
                        <label class="block text-sm mt-2">월</label>
                        <input type="number" class="month mt-1 p-2 w-full border rounded" placeholder="MM">
                        <label class="block text-sm mt-2">일</label>
                        <input type="number" class="day mt-1 p-2 w-full border rounded" placeholder="DD">
                        <label class="block text-sm mt-2">병명</label>
                        <input type="text" class="disease mt-1 p-2 w-full border rounded" placeholder="병명">
                        <label class="block text-sm mt-2">치료 내용</label>
                        <input type="text" class="treatment mt-1 p-2 w-full border rounded" placeholder="치료 내용">
                    </div>
                </div>
            </div>

            <!-- 참고 예시 -->
            <div class="mb-4">
                <h3 class="text-sm font-semibold">참고 예시</h3>
                <ul class="list-disc ml-6 text-sm text-gray-600">
                    <li>2023년 1월 13일 무릎통증으로 1회 통원 주사치료</li>
                    <li>2021년도 3월 14일 건강검진에서 대장용종 1개 제거</li>
                </ul>
            </div>

            <!-- 제출 버튼 -->
            <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">제출</button>
            <p id="error" class="error mt-2">모든 필수 항목을 입력해주세요.</p>
        </form>
    </div>

    <script>
        const form = document.getElementById('customerForm');
        const error = document.getElementById('error');

        // 라디오 버튼 변경 시 세부 항목 표시/숨김
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const details = this.closest('.mb-4').querySelector('.details');
                details.classList.toggle('hidden', this.value !== 'yes');
            });
        });

        // 폼 제출 처리
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const birthdate = document.getElementById('birthdate').value;
            const occupation = document.getElementById('occupation').value;

            if (!name || !birthdate || !occupation) {
                error.style.display = 'block';
                error.textContent = '이름, 생년월일, 직업을 입력해주세요.';
                return;
            }

            // 모든 문항에 답변했는지 확인
            for (let i = 1; i <= 5; i++) {
                if (!document.querySelector(`input[name="q${i}"]:checked`)) {
                    error.style.display = 'block';
                    error.textContent = '모든 고지사항 문항에 답변해주세요.';
                    return;
                }
            }

            const data = {
                name,
                birthdate,
                occupation,
                questions: []
            };

            // 고지사항 데이터 수집
            for (let i = 1; i <= 5; i++) {
                const radio = document.querySelector(`input[name="q${i}"]:checked`);
                const questionData = {
                    questionNumber: i,
                    answer: radio.value
                };

                if (radio.value === 'yes') {
                    const details = radio.closest('.mb-4').querySelector('.details');
                    questionData.year = details.querySelector('.year').value;
                    questionData.month = details.querySelector('.month').value;
                    questionData.day = details.querySelector('.day').value;
                    questionData.disease = details.querySelector('.disease').value;
                    questionData.treatment = details.querySelector('.treatment').value;
                }

                data.questions.push(questionData);
            }

            // Google Sheets로 데이터 전송
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbzaAhITW5kEjAuRie9d4zpUeQZ43LNfY4JbE-lab8PgJflL2gRF8RMCgDSENVF1tWHB/exec' {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    mode: 'cors'
                });
                const result = await response.json();
                if (result.status !== 'success') {
                    throw new Error(result.message || '서버 저장 실패');
                }
                alert('제출이 완료되었습니다!');
                error.style.display = 'none';
                form.reset();
                document.querySelectorAll('.details').forEach(detail => detail.classList.add('hidden'));
            } catch (error) {
                console.error('Error:', error);
                error.style.display = 'block';
                error.textContent = '데이터 저장에 실패했습니다. 다시 시도해주세요.';
            }
        });
    </script>
</body>
</html>